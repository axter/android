
APK保护方法之一：防止工具反编译之伪加密

伪加密是Android4.2.x系统发布前最流行的加密方式之一，通过java代码对APK(压缩文件)进行伪加密，其修改原理是修改连续4位字节标记为”P K 01 02”的后第5位字节，奇数表示不加密偶数表示加密。伪加密后的APK不但可以防止PC端对它的解压和查看也同样能防止反编译工具编译。

但是伪加密对其APK加密后市场也无法对其进行安全检测，部分市场会拒绝这类APK上传市场。伪加密的加密方式和解密方式也早已公布导致它的安全程度也大大降低。Android4.2+系统由于修改了签名验证的方式导致无法安装伪加密的APK。

对于伪加密的 代码，未加密apk和加密后的apk 的下载地址：http://dl1.zywa.com.cn/ijiami/apkbus/1.zip



APK保护方法之一：防止工具反编译之APK包破坏

APK在PC上面也可以看作一个压缩文件，在Android系统里面它是一个手机系统软件文件。Android系统对APK的识别是从标志头到标志尾，其他多余数据都会无视。所以说在标志尾添加其他数据对把APK看做压缩文件的PC端来说这个文件被破坏了，所以你要对其进行解压或者查看都会提示文件已损坏，用反编译工具也会提示文件已损坏，但是它却不会影响在Android系统里面的正常运行和安装而且也能兼容到所有系统。
但是这种APK压缩包破坏存在个别市场会不能识别导致不能上传市场。使用压缩文件修复工具也能把它修复好让我们做的保护消失。

对于APK包破坏的 代码，破坏前的apk和破坏后的apk 的下载地址：http://dl1.zywa.com.cn/ijiami/apkbus/2.zip


APK保护方法之一：防止工具反编译之素材中的图片故意破坏
素材破坏和包破坏的原理其实差不多，这种破坏也只是针对视apk为压缩文件的pc来说的。具体的做法是：在开发工具中(例如：eclipse)在打包前将jpg格式的图片强行修改成png（由于jpg和png格式图片的识别格式不一样 强行修改后 压缩文件在被解压缩的时候会对任何格式的文件进行验证，在验证到图片格式的时候 会因为文件类型与格式不一样导致无法反编译）。。这种保护措施不能防止查看主要是防止工具反编译(例如:apktool)，前提是不会影响其apk在手机上的正常运行。。
不过这种保护措施，在最新版本的apktool已经修复了。。在老版本的apktool上面这种保护措施是绝对可行的。





APK保护方法之三：运行时验证 – Android技术验证
        运行时验证，主要是指在代码启动的时候本地获取签名信息然后对签名信息进行检验来判断自己的应用是否是正版，如果签名信息不是正版则提示盗版或者直接崩溃。
原理：APK的唯一识别是根据包名+签名，包名信息是写死在AndroidManifest.xml里面的，但是签名则是与APK绑定的，一旦APK被反编译后签名会自动消失。APK的签名需要签名文件，签名文件的md5值基本上是无法伪造成一样的。
签名验证的方法也可以细分为3种：
1)        Java 层验证
获取签名信息和验证的方法都写在android 的java层。这种保护方法保护的意义并不大，因为反编译出源码后通过关键字搜索很快就能够找到验证的代码块，稍微一修改这验证保护就完全无效了。
目前市场上使用此方法验证的应用：神庙逃亡2，qq电池管家，微信，360手机管家等
2)        服务器验证
在android 的java层获取签名信息，上传服务器在服务端进行签名然后返回验证结果。这种保护还不如在纯java层验证有用，一旦没有网络验证保护就无效了。用android方法获取的签名信息用java方法也可以获取，验证存放在服务器上也是为了把保护正确的签名信息值，但是保护的意义其实没有任何作用。同样破解后全局搜索关键字然后伪造一个正确的签名信息就可以完美破解了。
目前市场上使用此方法验证的应用：地铁跑酷等
3)        NDK技术底层获取签名和验证
通过把Context,Activity,PackageManager,PackageInfo四个对象中的一个作为参数参入底层，在底层获取签名信息并验证。因为获取和验证的方法都封闭在更安全的so库里面，能够起到一定意义上的保护作用。不过通过java层的hook技术一样可以把这种保护完美破解。 但是相比于前两种，此保护的意义和价值就更大了。
目前市场上使用此方法验证的应用：植物大战僵尸2等



APK保护方法之三：运行时验证 – java技术验证
同样是获取签名信息进行验证，只是不是通过Android的方法，相比Android获取签名的方法用java获取签名更有意义，因为关键字搜索很容易就将Android获取签名的代码找到。
原理：通过Context的getPackageCodePath()和ApplicationInfo的sourceDir的方法获取apk本地储存地址，然后通过java获取签名的方法获取签名信息并验证。
此验证方法一般是通过ndk技术底层验证，此方法在和Android技术验证方式原理差别不大，不过效果会更好，安全作用更高。不过依旧有破解的方法，无法保证安全。
目前市场上使用此方法验证的应用：捕鱼达人2